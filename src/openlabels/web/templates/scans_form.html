{% extends "base.html" %}

{% block title %}New Scan - OpenLabels{% endblock %}
{% block page_title %}New Scan{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <form
        method="POST"
        action="/api/scans"
        hx-post="/api/scans"
        hx-swap="none"
        x-data="{ submitting: false, selectedTargets: [] }"
        @htmx:before-request="submitting = true"
        @htmx:after-request="submitting = false; if ($event.detail.successful) window.location.href = '/ui/scans'"
    >
        <div class="bg-white shadow rounded-lg">
            <div class="px-4 py-5 sm:p-6 space-y-6">
                <!-- Target Selection -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Select Targets</label>
                    <div
                        class="border border-gray-300 rounded-md max-h-60 overflow-y-auto"
                        hx-get="/ui/partials/target-checkboxes"
                        hx-trigger="load"
                        hx-swap="innerHTML"
                    >
                        <div class="p-4 text-center text-gray-500">Loading targets...</div>
                    </div>
                    <p class="mt-2 text-sm text-gray-500">Select one or more targets to scan</p>
                </div>

                <!-- Scan Options -->
                <div class="border-t border-gray-200 pt-6">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">Scan Options</h3>

                    <div class="space-y-4">
                        <div class="flex items-start">
                            <div class="flex items-center h-5">
                                <input
                                    type="checkbox"
                                    name="apply_labels"
                                    id="apply_labels"
                                    class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"
                                >
                            </div>
                            <div class="ml-3 text-sm">
                                <label for="apply_labels" class="font-medium text-gray-700">Apply sensitivity labels</label>
                                <p class="text-gray-500">Automatically apply Microsoft sensitivity labels to files with findings</p>
                            </div>
                        </div>

                        <div class="flex items-start">
                            <div class="flex items-center h-5">
                                <input
                                    type="checkbox"
                                    name="deep_scan"
                                    id="deep_scan"
                                    class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"
                                >
                            </div>
                            <div class="ml-3 text-sm">
                                <label for="deep_scan" class="font-medium text-gray-700">Deep scan</label>
                                <p class="text-gray-500">Extract and analyze text from images using OCR (slower)</p>
                            </div>
                        </div>

                        <div class="flex items-start">
                            <div class="flex items-center h-5">
                                <input
                                    type="checkbox"
                                    name="incremental"
                                    id="incremental"
                                    checked
                                    class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"
                                >
                            </div>
                            <div class="ml-3 text-sm">
                                <label for="incremental" class="font-medium text-gray-700">Incremental scan</label>
                                <p class="text-gray-500">Only scan files changed since the last scan</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Priority -->
                <div>
                    <label for="priority" class="block text-sm font-medium text-gray-700">Priority</label>
                    <select
                        name="priority"
                        id="priority"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm"
                    >
                        <option value="low">Low</option>
                        <option value="normal" selected>Normal</option>
                        <option value="high">High</option>
                    </select>
                    <p class="mt-2 text-sm text-gray-500">Higher priority scans will be processed first</p>
                </div>
            </div>

            <div class="px-4 py-3 bg-gray-50 text-right sm:px-6 space-x-3">
                <a
                    href="/ui/scans"
                    class="inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"
                >
                    Cancel
                </a>
                <button
                    type="submit"
                    :disabled="submitting"
                    class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 disabled:opacity-50"
                >
                    <span x-show="!submitting">Start Scan</span>
                    <span x-show="submitting">Starting...</span>
                </button>
            </div>
        </div>
    </form>
</div>
{% endblock %}

# =============================================================================
# OpenLabels Environment Configuration
# =============================================================================
#
# HOW TO USE THIS FILE:
#
# 1. Copy this file to create your local environment file:
#    cp .env.example .env
#
# 2. Edit .env and replace placeholder values with your actual configuration.
#    NEVER commit .env to version control - it contains secrets!
#
# 3. The application loads configuration in this priority order:
#    - Environment variables (highest priority)
#    - config.yaml file
#    - Default values (lowest priority)
#
# 4. Environment variables use the OPENLABELS_ prefix and __ for nested values.
#    Example: OPENLABELS_SERVER__PORT=8080 sets settings.server.port = 8080
#
# Required variables are marked with [REQUIRED]
# Optional variables are marked with [OPTIONAL] and show their defaults
#
# =============================================================================


# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================

# [REQUIRED] PostgreSQL database connection URL
# Format: postgresql+asyncpg://user:password@host:port/database
# For Alembic migrations, DATABASE_URL is also used (auto-converted to sync driver)
DATABASE_URL=postgresql+asyncpg://openlabels:your_secure_password@localhost:5432/openlabels

# [OPTIONAL] Database connection pool settings
# OPENLABELS_DATABASE__POOL_SIZE=5
# OPENLABELS_DATABASE__MAX_OVERFLOW=10


# =============================================================================
# SERVER CONFIGURATION
# =============================================================================

# [OPTIONAL] Server host binding (default: 127.0.0.1)
# Use 0.0.0.0 for Docker or when behind a reverse proxy
# SECURITY: Never expose directly to the internet without a reverse proxy
OPENLABELS_SERVER__HOST=127.0.0.1

# [OPTIONAL] Server port (default: 8000)
OPENLABELS_SERVER__PORT=8000

# [OPTIONAL] Number of worker processes (default: 4)
OPENLABELS_SERVER__WORKERS=4

# [OPTIONAL] Enable debug mode (default: false)
# SECURITY: Never enable in production - allows dev auth bypass
OPENLABELS_SERVER__DEBUG=false

# [OPTIONAL] Environment name: development, staging, production (default: development)
OPENLABELS_SERVER__ENVIRONMENT=development


# =============================================================================
# AUTHENTICATION (Azure AD / Microsoft Entra ID)
# =============================================================================

# [REQUIRED for production] Authentication provider: azure_ad or none
# SECURITY: Use 'azure_ad' in production. 'none' only works with DEBUG=true
AUTH_PROVIDER=azure_ad

# [REQUIRED when AUTH_PROVIDER=azure_ad] Azure AD tenant ID (GUID)
AUTH_TENANT_ID=your-tenant-id-guid

# [REQUIRED when AUTH_PROVIDER=azure_ad] App registration client/application ID (GUID)
AUTH_CLIENT_ID=your-client-id-guid

# [REQUIRED when AUTH_PROVIDER=azure_ad] App registration client secret
# SECURITY: Use a strong secret, rotate regularly, never commit to version control
AUTH_CLIENT_SECRET=your-client-secret-value


# =============================================================================
# CORS (Cross-Origin Resource Sharing)
# =============================================================================

# [OPTIONAL] Allowed origins for CORS (JSON array format, default: localhost only)
# SECURITY: Never use wildcard (*) in production. Specify explicit origins.
OPENLABELS_CORS__ALLOWED_ORIGINS=["http://localhost:3000","http://localhost:8000"]

# [OPTIONAL] Allow credentials in CORS requests (default: true)
# OPENLABELS_CORS__ALLOW_CREDENTIALS=true


# =============================================================================
# RATE LIMITING
# =============================================================================

# [OPTIONAL] Enable rate limiting (default: true)
# SECURITY: Keep enabled in production to prevent abuse
OPENLABELS_RATE_LIMIT__ENABLED=true

# [OPTIONAL] General API rate limit (default: 100/minute)
OPENLABELS_RATE_LIMIT__API_LIMIT=100/minute

# [OPTIONAL] Authentication endpoint rate limit (default: 10/minute)
# OPENLABELS_RATE_LIMIT__AUTH_LIMIT=10/minute

# [OPTIONAL] Scan creation rate limit (default: 20/minute)
# OPENLABELS_RATE_LIMIT__SCAN_CREATE_LIMIT=20/minute


# =============================================================================
# LOGGING
# =============================================================================

# [OPTIONAL] Log level: DEBUG, INFO, WARNING, ERROR (default: INFO)
OPENLABELS_LOGGING__LEVEL=INFO

# [OPTIONAL] Log file path (default: none, logs to stdout)
# OPENLABELS_LOGGING__FILE=/var/log/openlabels/server.log

# [OPTIONAL] Log format string
# OPENLABELS_LOGGING__FORMAT=%(asctime)s - %(name)s - %(levelname)s - %(message)s


# =============================================================================
# DETECTION ENGINE
# =============================================================================

# [OPTIONAL] Enable ML-based detection (default: true)
# Requires additional ML dependencies (transformers, torch/onnxruntime)
OPENLABELS_DETECTION__ENABLE_ML=true

# [OPTIONAL] Enable OCR for image-based documents (default: true)
# Requires Tesseract OCR to be installed
OPENLABELS_DETECTION__ENABLE_OCR=true

# [OPTIONAL] Minimum confidence threshold for detections (default: 0.70)
# OPENLABELS_DETECTION__CONFIDENCE_THRESHOLD=0.70

# [OPTIONAL] Maximum file size to process in MB (default: 100)
# OPENLABELS_DETECTION__MAX_FILE_SIZE_MB=100

# [OPTIONAL] ML device selection: auto, cuda, cpu (default: auto)
# Set to 'cpu' to force CPU even when GPU is available
OPENLABELS_DEVICE=auto


# =============================================================================
# TIMEOUTS (all values in seconds)
# =============================================================================

# HTTP Client Timeouts
# [OPTIONAL] Default HTTP request timeout (default: 30.0)
OPENLABELS_TIMEOUTS__HTTP_DEFAULT=30.0

# [OPTIONAL] HTTP connection establishment timeout (default: 10.0)
OPENLABELS_TIMEOUTS__HTTP_CONNECT=10.0

# [OPTIONAL] Health check endpoint timeout (default: 5.0)
# OPENLABELS_TIMEOUTS__HTTP_HEALTH_CHECK=5.0

# [OPTIONAL] Long-running operations timeout (default: 60.0)
# OPENLABELS_TIMEOUTS__HTTP_LONG_RUNNING=60.0

# Graph API Timeouts
# [OPTIONAL] Graph API request timeout (default: 30.0)
OPENLABELS_TIMEOUTS__GRAPH_API=30.0

# [OPTIONAL] Token acquisition timeout (default: 30.0)
# OPENLABELS_TIMEOUTS__GRAPH_TOKEN=30.0

# [OPTIONAL] Delta query pagination timeout (default: 60.0)
# OPENLABELS_TIMEOUTS__GRAPH_DELTA_PAGE=60.0

# Job Processing Timeouts
# [OPTIONAL] Default job timeout (default: 3600 = 1 hour)
OPENLABELS_TIMEOUTS__JOB_DEFAULT=3600

# [OPTIONAL] Scan job timeout (default: 7200 = 2 hours)
OPENLABELS_TIMEOUTS__JOB_SCAN=7200

# [OPTIONAL] Label job timeout (default: 1800 = 30 minutes)
# OPENLABELS_TIMEOUTS__JOB_LABEL=1800

# Detection/ML Timeouts
# [OPTIONAL] Individual detector timeout (default: 30.0)
# OPENLABELS_TIMEOUTS__DETECTOR=30.0

# [OPTIONAL] ML model loading timeout (default: 60.0)
# OPENLABELS_TIMEOUTS__MODEL_LOAD=60.0

# [OPTIONAL] OCR engine initialization timeout (default: 30.0)
# OPENLABELS_TIMEOUTS__OCR_READY=30.0

# WebSocket Timeouts
# [OPTIONAL] WebSocket ping interval (default: 20)
# OPENLABELS_TIMEOUTS__WEBSOCKET_PING=20

# [OPTIONAL] WebSocket receive timeout (default: 30.0)
# OPENLABELS_TIMEOUTS__WEBSOCKET_RECEIVE=30.0

# Database Timeout
# [OPTIONAL] Database query timeout (default: 30.0)
# OPENLABELS_TIMEOUTS__DB_QUERY=30.0

# Retry Settings
# [OPTIONAL] Base retry delay for exponential backoff (default: 2.0)
# OPENLABELS_TIMEOUTS__RETRY_BASE=2.0

# [OPTIONAL] Maximum retry delay (default: 3600 = 1 hour)
# OPENLABELS_TIMEOUTS__RETRY_MAX=3600

# Polling Intervals
# [OPTIONAL] Worker job poll interval (default: 1.0)
# OPENLABELS_TIMEOUTS__WORKER_POLL=1.0

# [OPTIONAL] Status check poll interval (default: 2.0)
# OPENLABELS_TIMEOUTS__STATUS_POLL=2.0

# [OPTIONAL] Worker concurrency check interval (default: 5)
# OPENLABELS_TIMEOUTS__CONCURRENCY_CHECK=5

# [OPTIONAL] Stuck job reclaim interval (default: 300 = 5 minutes)
# OPENLABELS_TIMEOUTS__STUCK_JOB_CHECK=300


# =============================================================================
# CIRCUIT BREAKER (Fault Tolerance)
# =============================================================================

# [OPTIONAL] Enable circuit breaker for external services (default: true)
OPENLABELS_CIRCUIT_BREAKER__ENABLED=true

# [OPTIONAL] Number of failures before circuit opens (default: 5)
OPENLABELS_CIRCUIT_BREAKER__FAILURE_THRESHOLD=5

# [OPTIONAL] Number of successes needed to close circuit (default: 2)
# OPENLABELS_CIRCUIT_BREAKER__SUCCESS_THRESHOLD=2

# [OPTIONAL] Seconds to wait before allowing test request (default: 60)
OPENLABELS_CIRCUIT_BREAKER__RECOVERY_TIMEOUT=60

# [OPTIONAL] HTTP status codes that don't count as failures (JSON array)
# OPENLABELS_CIRCUIT_BREAKER__EXCLUDE_STATUS_CODES=[400,401,403,404]


# =============================================================================
# JOB QUEUE CONFIGURATION
# =============================================================================

# [OPTIONAL] Maximum job retries (default: 3)
# OPENLABELS_JOBS__MAX_RETRIES=3

# [OPTIONAL] Base retry delay in seconds (default: 2)
# OPENLABELS_JOBS__RETRY_BASE_DELAY=2

# [OPTIONAL] Days to keep completed jobs (default: 7)
OPENLABELS_JOBS__COMPLETED_JOB_TTL_DAYS=7

# [OPTIONAL] Days to keep failed jobs (default: 30)
OPENLABELS_JOBS__FAILED_JOB_TTL_DAYS=30

# [OPTIONAL] Hours before alerting on pending jobs (default: 24)
# OPENLABELS_JOBS__PENDING_JOB_MAX_AGE_HOURS=24

# [OPTIONAL] Seconds before considering a running job stuck (default: 3600)
# OPENLABELS_JOBS__STUCK_JOB_TIMEOUT=3600

# [OPTIONAL] Default worker concurrency (default: 4)
# OPENLABELS_JOBS__DEFAULT_WORKER_CONCURRENCY=4

# [OPTIONAL] Maximum worker concurrency (default: 32)
# OPENLABELS_JOBS__MAX_WORKER_CONCURRENCY=32


# =============================================================================
# LABELING / MIP SDK CONFIGURATION
# =============================================================================

# [OPTIONAL] Enable automatic labeling (default: true)
# OPENLABELS_LABELING__ENABLED=true

# [OPTIONAL] Labeling mode: auto or recommend (default: auto)
# OPENLABELS_LABELING__MODE=auto

# [OPTIONAL] Sync labels on server startup (default: true)
# OPENLABELS_LABELING__AUTO_SYNC_ON_STARTUP=true

# [OPTIONAL] Hours between automatic label syncs (default: 24)
# OPENLABELS_LABELING__SYNC_INTERVAL_HOURS=24

# Label Cache Settings
# [OPTIONAL] Enable label caching (default: true)
# OPENLABELS_LABELING__CACHE__ENABLED=true

# [OPTIONAL] Label cache TTL in seconds (default: 300 = 5 minutes)
# OPENLABELS_LABELING__CACHE__TTL_SECONDS=300

# [OPTIONAL] Maximum cached labels (default: 1000)
# OPENLABELS_LABELING__CACHE__MAX_LABELS=1000

# MIP SDK Settings (Windows only)
# [OPTIONAL] Enable MIP SDK integration (default: false)
# Requires Windows with .NET Framework and MIP SDK assemblies
# OPENLABELS_LABELING__MIP__ENABLED=false

# [OPTIONAL] Path to MIP SDK assemblies
# OPENLABELS_LABELING__MIP__SDK_PATH=C:\Program Files\Microsoft Information Protection SDK

# [OPTIONAL] Application name for MIP (default: OpenLabels)
# OPENLABELS_LABELING__MIP__APP_NAME=OpenLabels

# [OPTIONAL] Application version for MIP (default: 1.0.0)
# OPENLABELS_LABELING__MIP__APP_VERSION=1.0.0


# =============================================================================
# ADAPTER CONFIGURATION
# =============================================================================

# Filesystem Adapter
# [OPTIONAL] Enable filesystem scanning (default: true)
# OPENLABELS_ADAPTERS__FILESYSTEM__ENABLED=true

# [OPTIONAL] Service account for filesystem access
# OPENLABELS_ADAPTERS__FILESYSTEM__SERVICE_ACCOUNT=

# SharePoint Adapter
# [OPTIONAL] Enable SharePoint scanning (default: true)
# OPENLABELS_ADAPTERS__SHAREPOINT__ENABLED=true

# [OPTIONAL] Scan all SharePoint sites (requires Sites.Read.All permission)
# OPENLABELS_ADAPTERS__SHAREPOINT__SCAN_ALL_SITES=false

# [OPTIONAL] Specific SharePoint sites to scan (JSON array)
# OPENLABELS_ADAPTERS__SHAREPOINT__SITES=["https://contoso.sharepoint.com/sites/HR"]

# OneDrive Adapter
# [OPTIONAL] Enable OneDrive scanning (default: true)
# OPENLABELS_ADAPTERS__ONEDRIVE__ENABLED=true

# [OPTIONAL] Scan all users' OneDrive (requires Files.Read.All permission)
# OPENLABELS_ADAPTERS__ONEDRIVE__SCAN_ALL_USERS=false

# [OPTIONAL] Specific users' OneDrive to scan (JSON array)
# OPENLABELS_ADAPTERS__ONEDRIVE__USERS=["user1@contoso.com","user2@contoso.com"]


# =============================================================================
# SECURITY SETTINGS
# =============================================================================

# [OPTIONAL] Maximum request body size in MB (default: 100)
# OPENLABELS_SECURITY__MAX_REQUEST_SIZE_MB=100


# =============================================================================
# SENTRY ERROR TRACKING (Optional)
# =============================================================================

# [OPTIONAL] Sentry DSN - leave empty to disable Sentry
# Get your DSN from https://sentry.io
SENTRY_DSN=

# [OPTIONAL] Override environment name for Sentry (defaults to server environment)
# OPENLABELS_SENTRY__ENVIRONMENT=production

# [OPTIONAL] Performance monitoring sample rate 0.0-1.0 (default: 0.1)
# OPENLABELS_SENTRY__TRACES_SAMPLE_RATE=0.1

# [OPTIONAL] Profiling sample rate 0.0-1.0 (default: 0.1)
# OPENLABELS_SENTRY__PROFILES_SAMPLE_RATE=0.1


# =============================================================================
# DOCKER-COMPOSE SPECIFIC
# =============================================================================

# [REQUIRED for docker-compose] PostgreSQL password for the database container
# SECURITY: Use a strong password in production
POSTGRES_PASSWORD=your_secure_postgres_password


# =============================================================================
# CLI / DEVELOPMENT
# =============================================================================

# [OPTIONAL] OpenLabels server URL for CLI commands (default: http://localhost:8000)
OPENLABELS_SERVER=http://localhost:8000

# [OPTIONAL] OpenLabels home directory for Windows service
# OPENLABELS_HOME=/opt/openlabels


# =============================================================================
# TESTING
# =============================================================================

# [OPTIONAL] Database URL for running integration tests
# If not set, database integration tests will be skipped
# TEST_DATABASE_URL=postgresql+asyncpg://openlabels:test@localhost:5432/openlabels_test

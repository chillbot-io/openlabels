# ============================================================================
# OpenLabels Environment Configuration
# ============================================================================
# Copy this file to .env and customize for your environment.
# Environment variables use the prefix OPENLABELS_ with __ as nested delimiter.
# Example: OPENLABELS_SERVER__PORT=8000
#
# Priority order (highest to lowest):
#   1. Environment variables
#   2. config.yaml file
#   3. Default values
# ============================================================================

# ============================================================================
# SERVER CONFIGURATION
# ============================================================================

# Host to bind the server to
# Default: 127.0.0.1 (localhost only for security)
# Set to 0.0.0.0 for production behind a reverse proxy
OPENLABELS_SERVER__HOST=127.0.0.1

# Port number for the server
OPENLABELS_SERVER__PORT=8000

# Number of worker processes
OPENLABELS_SERVER__WORKERS=4

# Enable debug mode (never enable in production)
OPENLABELS_SERVER__DEBUG=false

# Environment: development, staging, production
OPENLABELS_SERVER__ENVIRONMENT=development

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================

# PostgreSQL connection URL (asyncpg driver required)
# Format: postgresql+asyncpg://user:password@host:port/database
OPENLABELS_DATABASE__URL=postgresql+asyncpg://localhost/openlabels

# Database connection pool size (number of persistent connections)
# Adjust based on expected concurrent requests and database capacity
OPENLABELS_DATABASE__POOL_SIZE=5

# Maximum overflow connections above pool_size
# Total max connections = pool_size + max_overflow
OPENLABELS_DATABASE__MAX_OVERFLOW=10

# Legacy DATABASE_URL support (used by Alembic migrations)
DATABASE_URL=postgresql+asyncpg://localhost/openlabels

# Test database URL (for running tests)
# TEST_DATABASE_URL=postgresql+asyncpg://localhost/openlabels_test

# ============================================================================
# AUTHENTICATION (Azure AD / Microsoft Graph)
# ============================================================================

# Authentication provider: azure_ad or none
OPENLABELS_AUTH__PROVIDER=none

# Azure AD tenant ID (GUID)
OPENLABELS_AUTH__TENANT_ID=

# Azure AD application (client) ID (GUID)
OPENLABELS_AUTH__CLIENT_ID=

# Azure AD client secret
# SECURITY: Never commit actual secrets to version control!
OPENLABELS_AUTH__CLIENT_SECRET=

# ============================================================================
# LABELING CONFIGURATION
# ============================================================================

# Enable/disable labeling functionality
OPENLABELS_LABELING__ENABLED=true

# Labeling mode: auto (apply automatically) or recommend (suggest only)
OPENLABELS_LABELING__MODE=auto

# Auto-sync labels from Microsoft 365 on server startup
OPENLABELS_LABELING__AUTO_SYNC_ON_STARTUP=true

# How often to auto-sync labels (in hours)
OPENLABELS_LABELING__SYNC_INTERVAL_HOURS=24

# Label cache settings
OPENLABELS_LABELING__CACHE__ENABLED=true
OPENLABELS_LABELING__CACHE__TTL_SECONDS=300
OPENLABELS_LABELING__CACHE__MAX_LABELS=1000

# ============================================================================
# MIP SDK CONFIGURATION (Windows only)
# ============================================================================

# Enable Microsoft Information Protection SDK integration
# Requires Windows with .NET Framework
OPENLABELS_LABELING__MIP__ENABLED=false

# Path to MIP SDK assemblies
OPENLABELS_LABELING__MIP__SDK_PATH=

# Application name for MIP registration
OPENLABELS_LABELING__MIP__APP_NAME=OpenLabels

# Application version for MIP
OPENLABELS_LABELING__MIP__APP_VERSION=1.0.0

# ============================================================================
# DETECTION ENGINE CONFIGURATION
# ============================================================================

# Minimum confidence threshold for detections (0.0-1.0)
OPENLABELS_DETECTION__CONFIDENCE_THRESHOLD=0.70

# Enable machine learning-based detection
OPENLABELS_DETECTION__ENABLE_ML=true

# Enable OCR for image/PDF text extraction
OPENLABELS_DETECTION__ENABLE_OCR=true

# Maximum file size to process (in MB)
OPENLABELS_DETECTION__MAX_FILE_SIZE_MB=100

# Device for ML inference: cpu, cuda, mps (auto-detected if not set)
OPENLABELS_DEVICE=

# ============================================================================
# ADAPTER CONFIGURATION
# ============================================================================

# Filesystem adapter
OPENLABELS_ADAPTERS__FILESYSTEM__ENABLED=true
OPENLABELS_ADAPTERS__FILESYSTEM__SERVICE_ACCOUNT=

# SharePoint adapter
OPENLABELS_ADAPTERS__SHAREPOINT__ENABLED=true
OPENLABELS_ADAPTERS__SHAREPOINT__SCAN_ALL_SITES=false

# OneDrive adapter
OPENLABELS_ADAPTERS__ONEDRIVE__ENABLED=true
OPENLABELS_ADAPTERS__ONEDRIVE__SCAN_ALL_USERS=false

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================

# Log level: DEBUG, INFO, WARNING, ERROR
OPENLABELS_LOGGING__LEVEL=INFO

# Log file path (optional, logs to stdout if not set)
OPENLABELS_LOGGING__FILE=

# Log format
OPENLABELS_LOGGING__FORMAT=%(asctime)s - %(name)s - %(levelname)s - %(message)s

# ============================================================================
# CORS CONFIGURATION
# ============================================================================

# Allowed origins for CORS (comma-separated in config.yaml, or use JSON array)
# SECURITY: Never use wildcard (*) with credentials enabled
# OPENLABELS_CORS__ALLOWED_ORIGINS=["http://localhost:3000","http://localhost:8000"]

# Allow credentials (cookies, authorization headers)
OPENLABELS_CORS__ALLOW_CREDENTIALS=true

# ============================================================================
# RATE LIMITING
# ============================================================================

# Enable rate limiting
OPENLABELS_RATE_LIMIT__ENABLED=true

# Rate limits by endpoint type (format: "requests/period")
OPENLABELS_RATE_LIMIT__AUTH_LIMIT=10/minute
OPENLABELS_RATE_LIMIT__API_LIMIT=100/minute
OPENLABELS_RATE_LIMIT__SCAN_CREATE_LIMIT=20/minute

# ============================================================================
# SECURITY
# ============================================================================

# Maximum request body size (in MB)
OPENLABELS_SECURITY__MAX_REQUEST_SIZE_MB=100

# ============================================================================
# TIMEOUT CONFIGURATION
# ============================================================================

# HTTP client timeouts (in seconds)
OPENLABELS_TIMEOUTS__HTTP_DEFAULT=30.0
OPENLABELS_TIMEOUTS__HTTP_CONNECT=10.0
OPENLABELS_TIMEOUTS__HTTP_HEALTH_CHECK=5.0
OPENLABELS_TIMEOUTS__HTTP_LONG_RUNNING=60.0

# Graph API timeouts
OPENLABELS_TIMEOUTS__GRAPH_API=30.0
OPENLABELS_TIMEOUTS__GRAPH_TOKEN=30.0
OPENLABELS_TIMEOUTS__GRAPH_DELTA_PAGE=60.0

# Job processing timeouts
OPENLABELS_TIMEOUTS__JOB_DEFAULT=3600
OPENLABELS_TIMEOUTS__JOB_SCAN=7200
OPENLABELS_TIMEOUTS__JOB_LABEL=1800

# Detection/ML timeouts
OPENLABELS_TIMEOUTS__DETECTOR=30.0
OPENLABELS_TIMEOUTS__MODEL_LOAD=60.0
OPENLABELS_TIMEOUTS__OCR_READY=30.0

# WebSocket timeouts
OPENLABELS_TIMEOUTS__WEBSOCKET_PING=20
OPENLABELS_TIMEOUTS__WEBSOCKET_RECEIVE=30.0

# Database query timeout
OPENLABELS_TIMEOUTS__DB_QUERY=30.0

# ============================================================================
# CIRCUIT BREAKER (External Service Resilience)
# ============================================================================

# Enable circuit breaker pattern
OPENLABELS_CIRCUIT_BREAKER__ENABLED=true

# Number of failures before circuit opens
OPENLABELS_CIRCUIT_BREAKER__FAILURE_THRESHOLD=5

# Number of successes needed to close circuit
OPENLABELS_CIRCUIT_BREAKER__SUCCESS_THRESHOLD=2

# Seconds to wait before testing half-open state
OPENLABELS_CIRCUIT_BREAKER__RECOVERY_TIMEOUT=60

# ============================================================================
# JOB QUEUE CONFIGURATION
# ============================================================================

# Maximum job retry attempts
OPENLABELS_JOBS__MAX_RETRIES=3

# Base delay between retries (seconds, exponential backoff)
OPENLABELS_JOBS__RETRY_BASE_DELAY=2

# Auto-delete completed jobs after N days
OPENLABELS_JOBS__COMPLETED_JOB_TTL_DAYS=7

# Keep failed jobs for debugging (days)
OPENLABELS_JOBS__FAILED_JOB_TTL_DAYS=30

# Alert on jobs pending longer than N hours
OPENLABELS_JOBS__PENDING_JOB_MAX_AGE_HOURS=24

# Consider running jobs stuck after N seconds
OPENLABELS_JOBS__STUCK_JOB_TIMEOUT=3600

# Worker concurrency settings
OPENLABELS_JOBS__DEFAULT_WORKER_CONCURRENCY=4
OPENLABELS_JOBS__MAX_WORKER_CONCURRENCY=32

# ============================================================================
# CLI CONFIGURATION
# ============================================================================

# OpenLabels server URL for CLI commands
OPENLABELS_SERVER=http://localhost:8000

# OpenLabels data directory
# OPENLABELS_HOME=

# ============================================================================
# WINDOWS SERVICE CONFIGURATION (Windows only)
# ============================================================================

# User domain for service context
# USERDOMAIN=

# Local app data path (Windows)
# LOCALAPPDATA=
